###############################################################
# General Options
###############################################################
# enable 256 color support
set -g default-terminal "tmux-256color"
set -sa terminal-overrides ",xterm*:Tc"

# scrollback size
set -g history-limit 20000

# enable mouse support
set -g mouse on

# enable system clipboard
set -g set-clipboard on

# automatically renumber windows
set -g renumber-windows on

# set first window to index 1 (not 0)
set -g base-index 1
set -g pane-base-index 1

# make ESC delay shorter
set -sg escape-time 0

# change prefix from [ctrl+b] to [ctrl+<space>]
unbind C-b
set -g prefix C-Space

# ensure shell level begins at 1
set-environment -g SHLVL 1

# enable focus events
set-option -g focus-events on

# dynamically update window title
set-option -g set-titles on

# don't change tmux's own window titles.
set-option -gw automatic-rename off

# set the pane title
set-option -g set-titles-string "tmux: #S | #T"

# Show bells in window titles.
set-option -g window-status-bell-style fg=yellow,bold,underscore

# enable xterm key sequences
set-option -gw xterm-keys on

# add : to list of word separators
set-option -ga word-separators :/

# use vi motions when in copy-mode
set-window-option -g mode-keys vi

###############################################################
# Keybinds
###############################################################
# [ctrl +t] : new window
unbind-key C-t
bind-key C-t new-window

# [ctrl+w] : kill pane
unbind-key C-w
bind-key C-w kill-pane

# [ctrl+{h,l}] : cycle between windows
bind-key -r C-h select-window -t :-
bind-key -r C-l select-window -t :+

# [shift+alt+{H,J,K,L}] : pane resize shortcuts
bind-key -n M-H resize-pane -L 2
bind-key -n M-J resize-pane -D 2
bind-key -n M-K resize-pane -U 2
bind-key -n M-L resize-pane -R 2

# [shift+alt+{u,i,o,p}] : redistribute pane evenly
bind-key -n M-U select-layout main-horizontal
bind-key -n M-I select-layout main-vertical
bind-key -n M-O select-layout even-horizontal
bind-key -n M-P select-layout even-vertical

# cycle between sessions
bind-key -n M-> switch-client -n
bind-key -n M-< switch-client -p

# cycle between two recent sessions
bind-key -n M-F switch-client -l

# [shift+alt+z] : focus current pane
bind-key -n M-Z resize-pane -Z

# {h,j,k,l} : pane movement shortcuts
unbind-key h
bind-key h select-pane -L
unbind-key j
bind-key j select-pane -D
unbind-key k
bind-key k select-pane -U
unbind-key l
bind-key l select-pane -R

# r : reload tmux config
unbind-key r
bind-key r source-file ~/.config/tmux/tmux.conf \; display "Reloaded tmux config."

# redraw the client (if interrupted by wall, etc)
unbind-key R
bind-key R refresh-client

# show collapsed view of current sessions
bind-key s choose-tree -swZ

# T: open "test" vertical split
unbind-key t
bind-key t split-window -f -l 15 -c "#{pane_current_path}"

# t: open "test" horizontal split
unbind-key T
bind-key T split-window -h -f -p 35 -c "#{pane_current_path}"

# v: create vertical split
unbind-key v
bind-key v split-window -h

# -: create horizontal split
unbind-key -
bind-key - split-window

# on remote connections, use OSC52 script to handle clipboard copy/paste
if-shell -b '[ -n "$SSH_CONNECTION" -o -n "$SSH_TTY" -o -n "$SSH_CLIENT" ]' \
  "bind-key -T copy-mode-vi y send-keys -X copy-pipe osc52; \
  bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel osc52"

# inside WSL, send selections to Windows; otherwise defer to *nix
if-shell -b 'uname -r | grep -i "microsoft$"' \
	"bind-key -T copy-mode-vi y send-keys -X copy-pipe clip.exe; \
	bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel clip.exe" \
  "bind-key -T copy-mode-vi y send-keys -X copy-selection"

# stay in copy mode on mouse drag end event
unbind-key -T copy-mode-vi MouseDragEnd1Pane

# v: select text
bind-key -T copy-mode-vi v send-keys -X begin-selection

# V : select line
bind-key -T copy-mode-vi V send-keys -X select-line

###############################################################
# Status Line
###############################################################
# enable the status line
set -g status on

# set refresh interval for updating the status line
set -g status-interval 60

# set status line alignment
set -g status-justify left

# define pane border colors
set -g pane-border-style "fg=brightBlack"
set -g pane-active-border-style "fg=cyan"

# define pane identifier colors
set -g display-panes-colour black
set -g display-panes-active-colour brightblack

# define pane identifier colors
set -g window-style "bg=terminal"
set -g window-active-style "bg=terminal"

# define clock options
set -g clock-mode-colour cyan

# define message window colors
set -g message-style "fg=green dim"
set -g message-command-style "fg=cyan,bg=brightBlack"

# define mode colors
set -g mode-style "fg=black,bg=yellow bold"

# define status line base colors
set-option -g status-style "fg=blue"

# set max length of left status column
set-option -g status-left-length 40
# set information displayed to the left of the status line
set-option -g status-left " #S "

# define the window list colors
set-option -w -g window-status-style "fg=colour181"
# set status line for the current window
set-option -w -g window-status-current-style "fg=blue bold"

# set the format for displaying windows
set-option -w -g window-status-format " #[fg=colour248]#W "
# set the format for the current window
set-option -w -g window-status-current-format " #[fg=cyan]#W "

# set character used to separate the window list
set-option -w -g window-status-separator " "

# set information displayed to the right of the status line
set-option -g status-right "#[fg=colour248 dim] #(echo #h | awk '{print tolower($0)}') | #(date | awk '{print $2, $3}') | %l:%M #(echo %p | awk '{print tolower($0)}') "

# set status line for windows with an acitivity alert
set-option -w -g window-status-activity-style "bg=yellow,fg=black"
# set status line for windows with a bell alert
set-option -w -g window-status-bell-style "bg=red,fg=black"
